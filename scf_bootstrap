#!/var/lang/node20/bin/node

const { spawn } = require('child_process');
const path = require('path');

// 强制注入环境变量
process.env.PORT = '9000';
process.env.HOST = '0.0.0.0';
process.env.NODE_ENV = 'production';
process.env.NEXT_SWC_CACHE_DIR = '/tmp/.next_cache';

console.log(`[SCF] Starting Next.js...`);

const nextBin = path.join(__dirname, 'node_modules/next/dist/bin/next');

const server = spawn(
  '/var/lang/node20/bin/node',
  [nextBin, 'start', '--port', '9000', '--hostname', '0.0.0.0'],
  {
    cwd: __dirname,
    env: process.env,
    stdio: 'inherit',
  }
);

server.on('exit', (code) => {
  console.error(`[SCF] Process exited with code ${code}`);
  process.exit(code);
});
